<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Vivliostyle Pubがフォントを指定するしくみ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <section id="vivliostyle-pubがフォントを指定するしくみ" class="level1">
      <h1>Vivliostyle Pubがフォントを指定するしくみ</h1>
      <p>小形克宏（一般社団法人ビブリオスタイル理事）</p>
      <section id="はじめに" class="level2">
        <h2>はじめに</h2>
        <p>Vivliostyle Pub<a id="fnref1" href="#fn1" class="footnote-ref" role="doc-noteref"><sup>1</sup></a>は、「誰でもCSS組版を楽しめること」を目指して開発されたWebアプリだ。面倒なインストールやコマンドラインによる操作は不要、ネットに<ruby>繫<rt>つな</rt></ruby>がったブラウザさえあればCSS組版で本を作ることができる。一昨年から開発が進められてきたが、ようやく今年4月にアルファ版を公開するところまで達した。まだまだ開発途中ではあるが、一人でも多くのユーザーに使っていただき、可能ならフィードバックしてもらえるとありがたい<a id="fnref2" href="#fn2" class="footnote-ref" role="doc-noteref"><sup>2</sup></a>。</p>
        <p>
          <img src="content/ogwata/image/fig-1.png" alt="図1 アルファ版公開がはじまったVivliostyle Pub">
          <img src="./content/ogwata/image/fig-1.png" alt="図1 アルファ版公開がはじまったVivliostyle Pub">
          <img src="/content/ogwata/image/fig-1.png" alt="図1 アルファ版公開がはじまったVivliostyle Pub">
        </p>
        <p>さて、そのVivliostyle Pubだが、組版エンジン（Vivliostyle.js<a id="fnref3" href="#fn3" class="footnote-ref" role="doc-noteref"><sup>3</sup></a>）がプレビュー用はローカル、PDF出力用はクライドという具合いに、別々の場所に実装されている。後で詳しく述べるが、これはユーザの使い心地に直結するプレビュー表示を、少しでも早くするためだ<a id="fnref4" href="#fn4" class="footnote-ref" role="doc-noteref"><sup>4</sup></a>。</p>
        <p>ところが、組版エンジンを分離させた結果、ユーザが意識しないままプレビューとPDF出力とでフォントが食い違うことが起こり得るようになった。もしフォントが違えば、プレビューとPDF出力とで行数やページ数が違ってしまう。</p>
        <p>とはいえ、仮に食い違ってもそれはCSSにおける<code>font-family</code>の指定に従ってフォールバックした結果であり、その意味ではユーザーが指定した動作にすぎない。それでも、同人誌印刷では1ページ違えば印刷料金が変わることもある。知らないうちにプレビューとPDF出力でページが異なってしまえば、ユーザは不信感を持つだろう。</p>
        <p>この問題はいずれ解決するべきとは思うが、アーキテクチャの深い部分に関わるものであり、すぐには無理と思われる。本稿においてVivliostyle Pubがどのようにフォントを扱っているのかを詳しく説明することで、ユーザーの混乱を少しでも解消し、より多くの人がVivliostyle Pubを使ってもらう契機にできればと考えた。少しの間、お付き合いいただければ幸いである。</p>
        <p>なお、本稿の内容は、筆者が主に担当した「Vivliostyle Pubユーザガイド」<a id="fnref5" href="#fn5" class="footnote-ref" role="doc-noteref"><sup>5</sup></a>の一部を、一貫した読み物として再構成したものであることをお断りしておく。それから、本稿はVivliostyle Pubで執筆した<a id="fnref6" href="#fn6" class="footnote-ref" role="doc-noteref"><sup>6</sup></a>。</p>
      </section>
      <section id="themeによるフォント指定" class="level2">
        <h2>Themeによるフォント指定</h2>
        <p>現在のVivliostyle Pubでは、ワードプロセッサのように任意の部分のフォントや文字サイズを指定するようなUIはない。文書全体のスタイル情報を指定する「theme」（Vivliostyle Themes<a id="fnref7" href="#fn7" class="footnote-ref" role="doc-noteref"><sup>7</sup></a>）と呼ばれる仕組みの中でフォントや文字サイズを指定することになっている<a id="fnref8" href="#fn8" class="footnote-ref" role="doc-noteref"><sup>8</sup></a>。このthemeはVivliostyleによりnpmパッケージとして発行されており、これをActionメニューから指定したり切り替えたりすることが可能だ。</p>
      </section>
      <section id="vivliostyle-pubで扱えるフォントの種類" class="level2">
        <h2>Vivliostyle Pubで扱えるフォントの種類</h2>
      </section>
      <section id="プレビューとpdf出力におけるフォントを指定するしくみ" class="level2">
        <h2>プレビューとPDF出力におけるフォントを指定するしくみ</h2>
      </section>
      <section id="プレビューとpdf出力でフォントを一致させる方法" class="level2">
        <h2>プレビューとPDF出力でフォントを一致させる方法</h2>
      </section>
      <section id="おわりに" class="level2">
        <h2>おわりに</h2>
      </section>
    </section>
    <section class="footnotes" role="doc-endnotes">
      <hr>
      <ol>
        <li id="fn1" role="doc-endnote"><a href="https://github.com/vivliostyle/vivliostyle-pub">https://github.com/vivliostyle/vivliostyle-pub</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩</a></li>
        <li id="fn2" role="doc-endnote"><a href="https://vivliostyle-pub-develop.vercel.app/">https://vivliostyle-pub-develop.vercel.app/</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩</a></li>
        <li id="fn3" role="doc-endnote"><a href="https://github.com/vivliostyle/vivliostyle.js">https://github.com/vivliostyle/vivliostyle.js</a> <a href="#fnref3" class="footnote-back" role="doc-backlink">↩</a></li>
        <li id="fn4" role="doc-endnote">プレビューのレスポンス向上のため組版エンジンをローカルにおくのは、Vivliostyle Pubの前身である@spring-raining氏によるViola（<a href="https://github.com/violapub/viola">https://github.com/violapub/viola</a> ）に由来する。ただし、ViolaにはまだPDFの出力機能は実装されていなかった。<a href="#fnref4" class="footnote-back" role="doc-backlink">↩</a></li>
        <li id="fn5" role="doc-endnote"><a href="https://vivliostyle.github.io/docs-vivliostyle-pub/#/ja/">https://vivliostyle.github.io/docs-vivliostyle-pub/#/ja/</a><a href="#fnref5" class="footnote-back" role="doc-backlink">↩</a></li>
        <li id="fn6" role="doc-endnote"><a href="https://github.com/ogwata/tbf13-draft">https://github.com/ogwata/tbf13-draft</a><a href="#fnref6" class="footnote-back" role="doc-backlink">↩</a></li>
        <li id="fn7" role="doc-endnote"><a href="https://github.com/vivliostyle/themes">https://github.com/vivliostyle/themes</a><a href="#fnref7" class="footnote-back" role="doc-backlink">↩</a></li>
        <li id="fn8" role="doc-endnote">他にも、編集対象の文書の先頭で、HTMLの<code>span</code>要素や<code>div</code>要素の属性としてスタイル情報を指定したり、文書の冒頭で<code>style</code>要素を使ってスタイル情報を記述することもできる。とはいえUIと言えるようなものではなく、この辺りも今後の課題となろう。<a href="#fnref8" class="footnote-back" role="doc-backlink">↩</a></li>
      </ol>
    </section>
  </body>
</html>
