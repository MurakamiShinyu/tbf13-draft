# Vivliostyle Pubがフォントを指定するしくみ

小形克宏（一般社団法人ビブリオスタイル理事）

## はじめに

Vivliostyle Pubは、「誰でもCSS組版を楽しめること」を目指して開発されたWebアプリだ。面倒なインストールやコマンドラインによる操作は不要、ネットに接続されたブラウザさえあればCSS組版で本を作ることができる。一昨年から開発が進められてきたが、ようやく今年4月にアルファ版を公開するところまできた。まだまだ開発途中ではあるが、一人でも多くのユーザに使って、できればフィードバックをいただきたいと思っている[^1]。

![図1 アルファ版公開がはじまったVivliostyle Pub](content/ogwata/image/fig-1.png)

さて、そのVivliostyle Pubだが、組版エンジン（Vivliostyle.js）がプレビュー用と出力用とで別々の場所に実装されている。後で詳しく述べるが、ユーザの使い心地に直結するプレビュー表示を素早くするためこのようにしている[^2]。

ところが、このように組版エンジンを分離させた結果、ユーザが意識しないままプレビューとPDF出力とでフォントが変わってしまうことが発生するようになった。もしフォントが違えば、レビューとPDF出力とでページが食い違ってしまうことになる。

ただし仮に食い違っても、それはCSSにおける`font-family`の指定に従ってフォールバックした結果であり、その意味ではユーザーが指定した動作にすぎないとも言える。とはいえ、意識しないままレビューとPDF出力とでページが食い違えば、ユーザは不信感を持ってしまうだろう。

この問題はいずれ解決するべきとは思うが、アーキテクチャの深い部分に関わるものであり、すぐには無理と思われる。そこで本稿ではVivliostyle Pubがどのようにフォントを扱っているのかを詳しく説明することで、ユーザーの混乱を少しでも解消し、より多くの人がVivliostyle Pubを使ってもらう契機にしてもらえればと考えた。少しの間、お付き合いいただければ幸いである。

なお、本稿の内容は、筆者が主に担当した「Vivliostyle Pubユーザガイド」[^3]の一部を、一貫した読み物として再構成したものであることをお断りしておく。

## Themeによるフォント指定


## Vivliostyle Pubで扱えるフォントの種類

## プレビューとPDF出力におけるフォントを指定するしくみ

## プレビューとPDF出力でフォントを一致させる方法


## おわりに


[^1]: https://vivliostyle-pub-develop.vercel.app/
[^2]: プレビューのレスポンス向上のため組版エンジンをローカルにおくのは、Vivliostyle Pubの前身である@spring-raining氏によるViola（https://github.com/violapub/viola ）に由来する。ただし、ViolaにはまだPDFの出力機能は実装されていなかった。
[^3]: https://vivliostyle.github.io/docs-vivliostyle-pub/#/ja/